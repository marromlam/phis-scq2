
# decay_time_acceptance --------------------------------------------------------
#    These are several rules related to decay-time acceptance. The main one is
#    decay_time_acceptance, which computes the spline coefficients of the
#    Bs2JpsiPhi acceptance.

rule decay_time_acceptance:
  input:
    sample_BsMC = expand(rules.reduce_ntuples.output,
                         mode='MC_Bs2JpsiPhi_dG0',year='{year}',flag='{flag}'),
    sample_BdMC = expand(rules.reduce_ntuples.output,
                         mode='MC_Bd2JpsiKstar',year='{year}',flag='{flag}'),
    sample_BdDT = expand(rules.reduce_ntuples.output,
                         mode='Bd2JpsiKstar',year='{year}',flag='{flag}'),
    script = 'time_acceptance/baseline.py'
  output:
    params_BsMC = 'output/time_acceptance/parameters/{year}/MC_Bs2JpsiPhi_dG0/{flag}_{trigger}.json',
    params_BdMC = 'output/time_acceptance/parameters/{year}/MC_Bs_Bd_ratio/{flag}_{trigger}.json',
    params_BdDT = 'output/time_acceptance/parameters/{year}/Bs2JpsiPhi/{flag}_{trigger}.json'
  shell:
    """
    python {input.script}\
           --BsMC-sample {input.sample_BsMC}\
           --BdMC-sample {input.sample_BdMC}\
           --BdDT-sample {input.sample_BdDT}\
           --BsMC-params {output.params_BsMC}\
           --BdMC-params {output.params_BdMC}\
           --BdDT-params {output.params_BdDT}\
           --mode Bs2JpsiPhi\
           --year {wildcards.year}\
           --flag {wildcards.flag}\
           --trigger {wildcards.trigger}\
           --pycode {input.script}
    """



rule decay_time_acceptance_without_kinweights:
  input:
    sample_BsMC = expand(rules.reduce_ntuples.output,
                         mode='MC_Bs2JpsiPhi_dG0',year='{year}',flag='{flag}'),
    sample_BdMC = expand(rules.reduce_ntuples.output,
                         mode='MC_Bd2JpsiKstar',year='{year}',flag='{flag}'),
    sample_BdDT = expand(rules.reduce_ntuples.output,
                         mode='Bd2JpsiKstar',year='{year}',flag='{flag}'),
    params_BsMC = 'output/time_acceptance/parameters/{year}/MC_Bs2JpsiPhi_dG0/{flag}_{trigger}.json',
    params_BdMC = 'output/time_acceptance/parameters/{year}/MC_Bs_Bd_ratio/{flag}_{trigger}.json',
    params_BdDT = 'output/time_acceptance/parameters/{year}/Bs2JpsiPhi/{flag}_{trigger}.json'
  output:
    params_BsMC = 'output/time_acceptance/parameters/{year}/MC_Bs2JpsiPhi_dG0/{flag}_{trigger}_{script}.json',
    params_BdMC = 'output/time_acceptance/parameters/{year}/MC_Bs_Bd_ratio/{flag}_{trigger}_{script}.json',
    params_BdDT = 'output/time_acceptance/parameters/{year}/Bs2JpsiPhi/{flag}_{trigger}_{script}.json'
  shell:
    """
    python time_acceptance/{wildcards.script}.py\
           --BsMC-sample {input.sample_BsMC}\
           --BdMC-sample {input.sample_BdMC}\
           --BdDT-sample {input.sample_BdDT}\
           --BsMC-params {output.params_BsMC}\
           --BdMC-params {output.params_BdMC}\
           --BdDT-params {output.params_BdDT}\
           --mode Bs2JpsiPhi\
           --year {wildcards.year}\
           --flag {wildcards.flag}\
           --trigger {wildcards.trigger}\
           --pycode time_acceptance/{wildcards.script}.py
    """


rule decay_time_acceptance_single:
  input:
    sample = expand(rules.reduce_ntuples.output,
                    mode='{mode}',year='{year}',flag='{flag}'),
    script = 'time_acceptance/single.py'
  output:
    params = 'output/time_acceptance/parameters/{year}/{mode}/{flag}_{trigger}_single.json'
  shell:
    """
    python {input.script}\
           --sample {input.sample}\
           --params {output.params}\
           --mode {wildcards.mode}\
           --year {wildcards.year}\
           --flag {wildcards.flag}\
           --trigger {wildcards.trigger}\
           --pycode {input.script}
    """


# rule decay_time_acceptance_ratio:
#   input:
#     sample_BsMC = 'samples/MC_Bs2JpsiPhi_DG0_{year}.json',
#     sample_BdMC = 'samples/MC_Bd2JpsiKstar_{year}.json',
#     script = 'time_acceptance/{pycode}.py'
#   output:
#     shit = 'output/time_acceptance/{year}/{mode}/{pycode}/{flag}.json'
#   shell:
#     """
#     python {input.script}
#            --BsMC-sample {input.sample_BsMC}
#            --BdMC-sample {input.sample_BdMC}
#            --year        {input.year}
#            --model       {input.mode}
#            --flag        {input.flag}
#     """
#
#
# rule decay_time_acceptance_single:
#   input:
#     sample = 'samples/{mode}_{year}.json',
#     script = 'time_acceptance/{pycode}.py'
#   output:
#     shit = 'output/time_acceptance/{year}/{mode}/{pycode}/{flag}.json'
#   shell:
#     """
#     python {input.script}
#            --BsMC-sample {input.sample}
#            --year        {input.year}
#            --model       {input.mode}
#            --flag        {input.flag}
#     """
